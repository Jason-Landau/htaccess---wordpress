# BEGIN LSCACHE
## LITESPEED WP CACHE PLUGIN - Do not edit the contents of this block!  ##
<IfModule LiteSpeed>
RewriteEngine on
CacheLookup on
RewriteRule .* - [E=Cache-Control:no-autoflush]
RewriteRule litespeed/debug/.*\.log$ - [F,L]
RewriteRule \.litespeed_conf\.dat - [F,L]

### marker ASYNC start ###
RewriteCond %{REQUEST_URI} /wp-admin/admin-ajax\.php
RewriteCond %{QUERY_STRING} action=async_litespeed
RewriteRule .* - [E=noabort:1]
### marker ASYNC end ###

### marker MOBILE start ###
RewriteCond %{HTTP_USER_AGENT} Mobile|Android|Silk/|Kindle|BlackBerry|Opera\ Mini|Opera\ Mobi [NC]
RewriteRule .* - [E=Cache-Control:vary=%{ENV:LSCACHE_VARY_VALUE}+ismobile]
### marker MOBILE end ###

### marker WEBP start ###
RewriteCond %{HTTP_ACCEPT} image/webp [OR]
RewriteCond %{HTTP_USER_AGENT} iPhone\ OS\ (1[4-9]|[2-9][0-9]) [OR]
RewriteCond %{HTTP_USER_AGENT} Firefox/([6-9][0-9]|[1-9][0-9]{2,})
RewriteRule .* - [E=Cache-Control:vary=%{ENV:LSCACHE_VARY_VALUE}+webp]
### marker WEBP end ###

### marker DROPQS start ###
CacheKeyModify -qs:fbclid
CacheKeyModify -qs:gclid
CacheKeyModify -qs:utm*
CacheKeyModify -qs:_ga
### marker DROPQS end ###

</IfModule>
## LITESPEED WP CACHE PLUGIN - Do not edit the contents of this block! ##
# END LSCACHE
# BEGIN NON_LSCACHE
## LITESPEED WP CACHE PLUGIN - Do not edit the contents of this block! ##
### marker BROWSER CACHE start ###
<IfModule mod_expires.c>
ExpiresActive on
ExpiresByType application/pdf A31557600
ExpiresByType image/x-icon A31557600
ExpiresByType image/vnd.microsoft.icon A31557600
ExpiresByType image/svg+xml A31557600

ExpiresByType image/jpg A31557600
ExpiresByType image/jpeg A31557600
ExpiresByType image/png A31557600
ExpiresByType image/gif A31557600
ExpiresByType image/webp A31557600
ExpiresByType image/avif A31557600

ExpiresByType video/ogg A31557600
ExpiresByType audio/ogg A31557600
ExpiresByType video/mp4 A31557600
ExpiresByType video/webm A31557600

ExpiresByType text/css A31557600
ExpiresByType text/javascript A31557600
ExpiresByType application/javascript A31557600
ExpiresByType application/x-javascript A31557600

ExpiresByType application/x-font-ttf A31557600
ExpiresByType application/x-font-woff A31557600
ExpiresByType application/font-woff A31557600
ExpiresByType application/font-woff2 A31557600
ExpiresByType application/vnd.ms-fontobject A31557600
ExpiresByType font/ttf A31557600
ExpiresByType font/otf A31557600
ExpiresByType font/woff A31557600
ExpiresByType font/woff2 A31557600

</IfModule>
### marker BROWSER CACHE end ###

## LITESPEED WP CACHE PLUGIN - Do not edit the contents of this block! ##
# END NON_LSCACHE

# =========================================================
# Base security and proxy awareness
# =========================================================

# Prevent directory listing
Options -Indexes

# Follow symlinks (common on shared hosts)
Options +SymLinksIfOwnerMatch

# If behind a proxy/CDN (Cloudflare, etc.), ensure HTTPS is detected by WP.
<IfModule mod_setenvif.c>
    SetEnvIf X-Forwarded-Proto "^https$" HTTPS=on
</IfModule>

# Deny access to hidden files and version control folders
<IfModule mod_rewrite.c>
RewriteEngine On

# Block access to .git, .svn, and dotfiles (except well-known)
RewriteRule (^|/)\.(?!well-known/).* - [F]

# Protect common sensitive files
RewriteRule ^(composer\.(json|lock)|package\.json|yarn\.lock)$ - [F]
RewriteRule ^(\.env|\.env\..*|wp-config\.php|readme\.html|licen[cs]e\.txt)$ - [F]
</IfModule>

# =========================================================
# OPTIONAL: Canonical Redirects (choose ONE of the below)
# Comment BOTH sections if you don't want domain canonicalization.
# =========================================================

# --- Option A: Force HTTPS (safe with proxies) ---
<IfModule mod_rewrite.c>
RewriteEngine On
# If not HTTPS and not signaled via proxy header, redirect to HTTPS
RewriteCond %{HTTPS} !=on
RewriteCond %{HTTP:X-Forwarded-Proto} !https
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</IfModule>

# --- Option B1: Force NON-WWW (uncomment to enable) ---
#<IfModule mod_rewrite.c>
#RewriteEngine On
#RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
#RewriteRule ^ https://%1%{REQUEST_URI} [L,R=301]
#</IfModule>

# --- Option B2: Force WWW (uncomment to enable) ---
#<IfModule mod_rewrite.c>
#RewriteEngine On
#RewriteCond %{HTTP_HOST} !^www\..+$ [NC]
#RewriteCond %{HTTP_HOST} ^(.+)$ [NC]
#RewriteRule ^ https://www.%1%{REQUEST_URI} [L,R=301]
#</IfModule>

# =========================================================
# WordPress core rewrites
# (Leave this block intact; WP updates it on Permalink save)
# =========================================================
# BEGIN WordPress
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /

# Don't rewrite existing files or directories
RewriteRule ^index\.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

# Route everything else to WP front controller
RewriteRule . /index.php [L]
</IfModule>
# END WordPress

# =========================================================
# REST API / admin-ajax: do NOT cache; avoid breaking JSON
# (Helps with Rank Math "response is not a valid JSON" issues)
# =========================================================
<IfModule mod_headers.c>
    # Flag REST and admin-ajax requests as no-cache
    <FilesMatch "^(.*)$">
        SetEnvIf Request_URI "^/wp-json/.*" IS_WPJSON=1
        SetEnvIf Request_URI "rest_route=" IS_WPJSON=1
        SetEnvIf Request_URI "^/wp-admin/admin-ajax\.php$" IS_AJAX=1
    </FilesMatch>

    Header set Cache-Control "no-cache, no-store, must-revalidate" env=IS_WPJSON
    Header set Pragma "no-cache" env=IS_WPJSON
    Header set Expires "0" env=IS_WPJSON

    Header set Cache-Control "no-cache, no-store, must-revalidate" env=IS_AJAX
    Header set Pragma "no-cache" env=IS_AJAX
    Header set Expires "0" env=IS_AJAX
</IfModule>

# If you use any maintenance mode or security plugins, ensure they do NOT intercept /wp-json/* or admin-ajax.php

# =========================================================
# CORS for REST (optional, only if your frontend needs it)
# =========================================================
#<IfModule mod_headers.c>
#    <LocationMatch "^/wp-json/">
#        Header always set Access-Control-Allow-Origin "*"
#        Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
#        Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
#    </LocationMatch>
#</IfModule>

# =========================================================
# XML-RPC (optional: block if you don't use Jetpack/mobile apps)
# =========================================================
#<Files "xmlrpc.php">
#    Order allow,deny
#    Deny from all
#</Files>

# =========================================================
# MIME and security headers (basic, safe defaults)
# =========================================================
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set X-XSS-Protection "1; mode=block"
    # If you later add a CSP, do it carefully to not break admin/editor:
    # Header always set Content-Security-Policy "default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https:;"
</IfModule>

# =========================================================
# PHP Version Handler (WHM/cPanel EasyApache)
# =========================================================

# php -- BEGIN cPanel-generated handler, do not edit
# Set the “ea-php83” package as the default “PHP” programming language.
<IfModule mime_module>
  AddHandler application/x-httpd-ea-php83 .php .php8 .phtml
</IfModule>
# php -- END cPanel-generated handler, do not edit